window.Select=(Select=function(e,l){var s=this,n=function(e,t){for(var l in e)void 0===t[l]?t[l]=e[l]:"object"==typeof t[l]&&n(e[l],t[l])};return s.options=l||{},s.selector=e,s.hint="",s.value="",s.listTemplate="",s.multiple=!1,s.size=1,s.opened=!1,s.selectedIndex=-1,s.lastSelectedIndex=-1,s.focusedIndex=0,s.lastFocusedIndex=0,s.$select=null,s.$options=null,s.$wrapper=null,s.$button=null,s.$list=null,s.$listItems=[],s.$lastSelectedItem=null,s.$selectedItems=null,s.openSelectHandler=s.openSelect.bind(s),s.closeSelectHandler=s.closeSelect.bind(s),s.clickHandler=s.clickHandler.bind(s),s.keyHandler=s.keyHandler.bind(s),s.isListItem=function(e,t){return t=t||0,null!==e&&3!==t&&(e.dataset.value&&e.tagName===l.listItemTag.toUpperCase()?e:(t++,s.isListItem(e.parentElement,t)))},s.isButton=function(e,t){return t=t||0,null!==e&&3!==t&&(e.dataset.hint&&"BUTTON"===e.tagName?e:(t++,s.isButton(e.parentElement,t)))},s.getListItemIndex=function(e,t){for(var l=0;l<e.length;l++)if(t===e[l])return l;return-1},n({openOnHover:!1,openOnClick:!0,escToClose:!0,outsideClickToClose:!0,scrollToClose:!0,closeIfAllSelected:!0,titleTag:"span",listTag:"ul",wrapperTag:"div",listItemTag:"li",wrapperClass:"",titleClass:"",setListTemplate:null,copyAttributes:["class"]},s.options),s.init(),s.$select},Select.prototype.init=function(){function e(e,t){return(t=t||document.body).querySelector(e)}function t(e){return document.createElement(e)}var l=this,s=l.options,n=s.wrapperClass,c=s.buttonClass;l.$select=e(l.selector),l.$select.openSelect=l.openSelectHandler,l.$select.closeSelect=l.closeSelectHandler,l.$options=l.$select.options,l.multiple=l.$select.hasAttribute("multiple"),l.size=l.$select.getAttribute("size")||1,l.$wrapper=t(s.wrapperTag),l.$button=t("button"),l.$list=t(s.listTag),l.$button.setAttribute("type","button"),l.$wrapper.appendChild(l.$button),l.multiple&&(l.selectedIndex=[],l.$selectedItems=[],l.selectedIndex=[]);for(var i=0,a=0;i<l.$options.length;i++){var o,d,r=l.$options[i];l.multiple&&r.hasAttribute("disabled")||!l.multiple&&r.selected?l.hint=r.label||r.textContent:(o=t(s.listItemTag),(d=r.className)&&o.classList.add(d),l.multiple&&r.selected&&o.classList.add("selected"),o.innerHTML=r.label||r.textContent,o.dataset.value=r.value,l.$listItems[a]=o,l.$list.appendChild(o),a++)}l.$button.textContent=l.hint,l.$button.dataset.hint=l.hint,n&&l.$wrapper.classList.add(n),c&&l.$button.classList.add(c),s.copyAttributes.forEach(function(e){l.$select.hasAttribute(e)&&l.$list.setAttribute(e,l.$select.getAttribute(e))}),l.listClassName=l.$list.classList[0],l.listSelector=s.listTag+"."+l.listClassName;l.$list.outerHTML;"function"==typeof s.setListTemplate?l.listTemplate=s.setListTemplate(l.$list.outerHTML):l.listTemplate=l.$list.outerHTML,l.$wrapper.insertAdjacentHTML("beforeend",l.listTemplate),l.$select.insertAdjacentElement("beforebegin",l.$wrapper),l.$wrapper.insertAdjacentElement("beforeend",l.$select),l.$select.style.display="none",l.$list=e(l.listSelector,l.$wrapper),l.$listItems=l.$list.children,l.$wrapper.addEventListener("click",l.clickHandler),document.addEventListener("click",l.clickHandler),document.addEventListener("keydown",l.keyHandler)},Select.prototype.clickHandler=function(e){var t=this,l=t.options,s=e.target,n=t.$listItems,c=t.isButton(s);if(listItem=t.isListItem(s),event.currentTarget===document){var i=t.options.wrapperClass||t.listClassName;s.querySelector("."+i)&&t.closeSelect(t)}else if(c)s=c,t.opened?t.closeSelect(t):t.openSelect(t);else if(listItem){if(s=listItem,t.multiple)if("all"===s.dataset.value){t.$selectedItems=[],t.selectedIndex=[],t.lastSelectedIndex=-1;for(var a=0;a<n.length;a++)n[a].classList.remove("selected"),s!==n[a]&&(t.$selectedItems.push(n[a]),t.selectedIndex.push(a));l.closeIfAllSelected&&t.closeSelect(t)}else{if(s.classList.contains("selected")){s.classList.remove("selected");var o=t.$selectedItems.indexOf(s);return void(-1!==o&&(t.$selectedItems.splice(o,1),t.selectedIndex.splice(o,1)))}for(var d=0,r=0;r<n.length;r++)n[r].classList.contains("selected")&&d++,"all"===n[r].dataset.value&&n[r].classList.contains("selected")&&(n[r].classList.remove("selected"),t.$selectedItems=[],t.selectedIndex=[]),n[r]===s&&(t.lastSelectedIndex=r);t.selectedIndex.push(t.lastSelectedIndex),t.$selectedItems.push(s),l.closeIfAllSelected&&d===t.$listItems.length-2&&t.closeSelect(t)}else{for(var p=0;p<n.length;p++)n[p].classList.remove("selected");t.$selectedItems=s,t.closeSelect(t),t.lastSelectedIndex=t.selectedIndex,t.selectedIndex=t.getListItemIndex(n,s)}s.classList.add("selected")}},Select.prototype.keyHandler=function(){var e=this,t=event.keyCode;e.opened&&27===t&&e.closeSelect(e)},Select.prototype.openSelect=function(){var e=this;e.opened||(e.dispatchEvent(e.$select,"open",e.selectedIndex),e.$wrapper.classList.add("active"),e.opened=!0)},Select.prototype.closeSelect=function(e){var t=this;t.opened&&(t.dispatchEvent(t.$select,"close"),t.$wrapper.classList.remove("active"),t.opened=!1)},Select.prototype.dispatchEvent=function(e,t){var l;"function"==typeof window.CustomEvent&&(l=new CustomEvent(t),e.dispatchEvent(l))},Select);